<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publications</title>
    <style>
        /* CSS Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
        }

        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        #search-input {
            width: 100%;
            max-width: 600px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .highlight {
            background-color: #ffeb3b;
            padding: 0 2px;
            border-radius: 2px;
        }

        .filters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 150px;
        }

        .publication-section {
            margin-bottom: 20px;
            border: 1px solid #eee;
            border-radius: 5px;
            overflow: hidden;
        }

        .section-header {
            background-color: #f5f5f5;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: #2c3e50;
        }

        .publication-list {
            padding: 10px 0;
        }

        .publication-list.hidden {
            display: none;
        }

        .publication {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .publication:last-child {
            border-bottom: none;
        }

        .publication-year {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .publication-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .publication-authors {
            margin-bottom: 5px;
        }

        .publication-venue {
            font-style: italic;
            color: #666;
            margin-bottom: 8px;
        }

        .publication-links a {
            display: inline-block;
            margin-right: 15px;
            color: #3498db;
            text-decoration: none;
        }

        .publication-links a:hover {
            text-decoration: underline;
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: #666;
            font-style: italic;
        }

        .loading-indicator {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            padding: 20px;
            background-color: #fff1f0;
            border: 1px solid #ffccc7;
            border-radius: 4px;
            color: #a8071a;
        }

        .error h3 {
            margin-bottom: 10px;
        }

        .error-help {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .tip {
            padding: 15px;
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .refresh-button {
            display: block;
            margin: 10px auto;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .refresh-button:hover {
            background-color: #2980b9;
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                gap: 10px;
            }

            select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Publications</h1>
    
    <div id="load-info" class="tip">
        <strong>Note:</strong> This page loads publications from an external BibTeX file.
        <button id="refresh-button" class="refresh-button">Reload Publications</button>
    </div>
    
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search publications...">
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <label for="year-filter">Year</label>
            <select id="year-filter">
                <option value="all">All years</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="type-filter">Type</label>
            <select id="type-filter">
                <option value="all">All types</option>
            </select>
        </div>
    </div>
    
    <div id="publications-container">
        <div class="loading-indicator">Loading publications from BibTeX file...</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const container = document.getElementById('publications-container');
            const searchInput = document.getElementById('search-input');
            const yearFilter = document.getElementById('year-filter');
            const typeFilter = document.getElementById('type-filter');
            const refreshButton = document.getElementById('refresh-button');
            
            // State
            let publications = [];
            let years = new Set();
            let types = new Set();
            
            // Loading Publication
            loadPublications();
            
            
            refreshButton.addEventListener('click', loadPublications);
            
            /* To load and parse the BibTeX file (citation_arranged.bib), cache busting parameter to prevent browser caching,
            Fetching the BibTeX file and checking status; Successfull or Failed to load.
            */
            
            function loadPublications() {
                container.innerHTML = '<div class="loading-indicator">Loading publications from BibTeX file...</div>';
                const cacheBuster = `?cache=${Date.now()}`;
               
                fetch('citation_arranged.bib' + cacheBuster)
                    .then(response => {
                        console.log('Response status:', response.status);
                        
                        if (!response.ok) {
                            throw new Error(`Failed to load BibTeX file (${response.status}: ${response.statusText})`);
                        }
                        
                        return response.text();
                    })
                    .then(data => {
                        console.log('BibTeX file loaded, length:', data.length);
                        
                        if (!data || data.trim().length === 0) {
                            throw new Error('BibTeX file is empty');
                        }
                        
                        //Logs to check the content of the file & parsing
                        console.log('File preview:', data.substring(0, 200) + '...');

                        publications = parseBibTeX(data);
                        console.log(`Parsed ${publications.length} publications`);
                        
                        if (publications.length === 0) {
                            throw new Error('No publications found in BibTeX file');
                        }
                        
                        // Reseting the year and type filters
                        years.clear();
                        types.clear();
                        
                        publications.forEach(pub => {
                            if (pub.year) years.add(pub.year);
                            types.add(pub.type);
                        });
                        
                        
                        populateFilters();
                        displayPublications();
                        setupEventListeners();
                    })

                    // Error loading publications and troubleshootinh steps to follow
                    .catch(error => {
                        console.error('Error loading publications:', error);
                        
                        container.innerHTML = `
                            <div class="error">
                                <h3>Error loading publications</h3>
                                <p>${error.message}</p>
                                <div class="error-help">
                                    <h4>Troubleshooting steps:</h4>
                                    <ol>
                                        <li>Ensure "citation_arranged.bib" is in the same directory as this HTML file</li>
                                        <li>This page must be served through a web server (not opened directly from file system)</li>
                                        <li>Check browser console (F12) for more detailed error messages</li>
                                        <li>Verify your BibTeX file format</li>
                                    </ol>
                                </div>
                            </div>
                        `;
                    });
            }
            
            
            function parseBibTeX(text) {
                const entries = [];
                
                // splitting on entry tags
                const entryRegex = /@(\w+)\s*{([^,]+),([^@]+?)(?=\s*@|\s*$)/gs;
                let match;
                
                while ((match = entryRegex.exec(text)) !== null) {
                    const type = match[1].toLowerCase();
                    const key = match[2].trim();
                    const content = match[3];
                    
                    console.log(`Found entry of type ${type} with key ${key}`);
                    
                    const entry = { type, key };
                    
                    
                    // Extractinf fields for the publicatios list; Title, Author, Year, Journal, Books and others.
                    const titleMatch = content.match(/title\s*=\s*(?:{([^}]*)}|"([^"]*)")/);
                    if (titleMatch) {
                        entry.title = (titleMatch[1] || titleMatch[2]).trim();
                    }
                    
                  
                    const authorMatch = content.match(/author\s*=\s*{([^}]*)}/);
                    if (authorMatch) {
                        entry.author = authorMatch[1].trim();
                    }
                    
                 
                    const yearMatch = content.match(/year\s*=\s*{?(\d+)}?/);
                    if (yearMatch) {
                        entry.year = yearMatch[1];
                    }
                    
             
                    const journalMatch = content.match(/journal\s*=\s*{([^}]*)}/);
                    if (journalMatch) {
                        entry.journal = journalMatch[1].trim();
                    }
                    
                    const booktitleMatch = content.match(/booktitle\s*=\s*{([^}]*)}/);
                    if (booktitleMatch) {
                        entry.booktitle = booktitleMatch[1].trim();
                    }
                    
                    // need to fix 
                    const otherFields = [
                        'volume', 'number', 'pages', 'publisher', 'address',
                        'doi', 'url', 'month', 'series', 'isbn'
                    ];
                    
                    otherFields.forEach(field => {
                        const fieldRegex = new RegExp(`${field}\\s*=\\s*{([^}]*)}`, 'i');
                        const fieldMatch = content.match(fieldRegex);
                        if (fieldMatch) {
                            entry[field] = fieldMatch[1].trim();
                        }
                    });
                    
                    entries.push(entry);
                }
                
                return entries;
            }
            
            // Format author names for display
            function formatAuthors(authors) {
                if (!authors) return '';
                
                return authors.split(' and ')
                    .map(author => {
                        const parts = author.split(',');
                        if (parts.length > 1) {
                            return parts[1].trim() + ' ' + parts[0].trim();
                        }
                        return author.trim();
                    })
                    .join(', ');
            }
            
            
            function populateFilters() {
                // Clear existing options except first
                while (yearFilter.options.length > 1) {
                    yearFilter.remove(1);
                }
                
                while (typeFilter.options.length > 1) {
                    typeFilter.remove(1);
                }
                
                // filters for sorting years and fetching types of the publications
                const sortedYears = Array.from(years).sort((a, b) => parseInt(b) - parseInt(a));
                sortedYears.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearFilter.appendChild(option);
                });
                
            
                const typeLabels = {
                    'article': 'Journal Articles',
                    'inproceedings': 'Conference Papers',
                    'techreport' : 'Research Papers',
                    'incollection': 'Presentations & Speeches',
                    'book': 'Books',
                    'misc': 'Miscellaneous'
                };
                
                Array.from(types).sort().forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = typeLabels[type] || type.charAt(0).toUpperCase() + type.slice(1);
                    typeFilter.appendChild(option);
                });
            }
            
           
            function setupEventListeners() {

                // removing the old Events
                searchInput.removeEventListener('input', displayPublications);
                yearFilter.removeEventListener('change', displayPublications);
                typeFilter.removeEventListener('change', displayPublications);
                
                // Adding new events
                searchInput.addEventListener('input', displayPublications);
                yearFilter.addEventListener('change', displayPublications);
                typeFilter.addEventListener('change', displayPublications);
            }
            
            //Displaying publications
            function displayPublications() {
                const searchTerm = searchInput.value.toLowerCase();
                const yearValue = yearFilter.value;
                const typeValue = typeFilter.value;
                
                
                const filtered = publications.filter(pub => {
                    
                    if (yearValue !== 'all' && pub.year !== yearValue) return false;
                    
                    
                    if (typeValue !== 'all' && pub.type !== typeValue) return false;
                    
                    
                    if (searchTerm) {
                        return (
                            (pub.title && pub.title.toLowerCase().includes(searchTerm)) ||
                            (pub.author && pub.author.toLowerCase().includes(searchTerm)) ||
                            (pub.journal && pub.journal.toLowerCase().includes(searchTerm)) ||
                            (pub.booktitle && pub.booktitle.toLowerCase().includes(searchTerm))
                        );
                    }
                    
                    return true;
                });
                
                // Grouping by Type
                const grouped = {};
                
                filtered.forEach(pub => {
                    if (!grouped[pub.type]) {
                        grouped[pub.type] = [];
                    }
                    grouped[pub.type].push(pub);
                });
                
                
                container.innerHTML = '';
                
                // Handelling no results
                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            No publications match your search criteria.
                        </div>
                    `;
                    return;
                }
                
                // Type order and labels
                const typeOrder = ['inproceedings', 'article', 'book', 'incollection', 'misc'];
                const typeLabels = {
                    'inproceedings': 'Conference Papers',
                    'article': 'Journal Articles',
                    'techreport' : 'Research Papers',
                    'incollection': 'Presentations & Speeches',
                    'book': 'Books',
                    'misc': 'Other Publications'
                };
                
                
                typeOrder.forEach(type => {
                    if (!grouped[type] || grouped[type].length === 0) return;
                    
               
                    const sorted = grouped[type].sort((a, b) => {
                        const yearA = parseInt(a.year || '0');
                        const yearB = parseInt(b.year || '0');
                        return yearB - yearA;
                    });
                    
                    const section = document.createElement('div');
                    section.className = 'publication-section';
                    
                    
                    const header = document.createElement('div');
                    header.className = 'section-header';
                    header.innerHTML = `
                        <h2>${typeLabels[type] || type.charAt(0).toUpperCase() + type.slice(1)}</h2>
                        <span class="toggle">▼</span>
                    `;
                    
                    const pubList = document.createElement('div');
                    pubList.className = 'publication-list';
                    
                /* loop through each publication list; parsed from BibTeX file,
                Determining the category in publication list and adding specific information to each category,
                Creating HTML element for each publication and populating it with extracted information Title, author, year and etc.
                */
                    sorted.forEach(pub => {
                       
                        let venue = '';
                        
                        if (pub.journal) {
                            venue = pub.journal;
                            if (pub.volume) venue += `, ${pub.volume}`;
                            if (pub.number) venue += `(${pub.number})`;
                            if (pub.pages) venue += `, pp. ${pub.pages}`;
                        } else if (pub.booktitle) {
                            venue = pub.booktitle;
                            if (pub.pages) venue += `, pp. ${pub.pages}`;
                        }
                        
                        if (pub.publisher) {
                            venue += venue ? `, ${pub.publisher}` : pub.publisher;
                        }
                        
                        if (pub.address) {
                            venue += venue ? `, ${pub.address}` : pub.address;
                        }
                        
                       
                        const pubEl = document.createElement('div');
                        pubEl.className = 'publication';
                        pubEl.innerHTML = `
                            <div class="publication-year">${pub.year || ''}</div>
                            <div class="publication-title">${pub.title || 'Untitled'}</div>
                            <div class="publication-authors">${formatAuthors(pub.author)}</div>
                            ${venue ? `<div class="publication-venue">${venue}</div>` : ''}
                            <div class="publication-links">
                                ${pub.doi ? `<a href="https://doi.org/${pub.doi}" target="_blank">DOI</a>` : ''}
                                ${pub.url ? `<a href="${pub.url}" target="_blank">Link</a>` : ''}
                            </div>
                        `;
                        
                        pubList.appendChild(pubEl);
                    });
                    
                    section.appendChild(header);
                    section.appendChild(pubList);
                    container.appendChild(section);
                    
                    // Habdelling functionality for each category
                    header.addEventListener('click', () => {
                        header.classList.toggle('collapsed');
                        pubList.classList.toggle('hidden');
                        const toggle = header.querySelector('.toggle');
                        toggle.textContent = pubList.classList.contains('hidden') ? '▲' : '▼';
                    });
                });
            }
        });
    </script>
</body>
</html>
